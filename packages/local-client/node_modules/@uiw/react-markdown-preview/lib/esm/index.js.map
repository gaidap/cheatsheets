{"version":3,"sources":["../../src/index.tsx"],"names":["React","Component","Prism","ReactMarkdown","ReactMarkdownProps","allowNode","loadLang","MarkdownPreview","props","mdp","createRef","loadedLang","state","value","source","highlight","prevProps","setState","mdStr","current","codes","getElementsByTagName","tag","parentNode","tagName","test","className","trim","lang","replace","includes","push","highlightElement","style","onScroll","onMouseOver","other","cls","defaultProps","renderers"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Prism from 'prismjs';\nimport 'prismjs/components/prism-markup';\nimport ReactMarkdown, { ReactMarkdownProps } from 'react-markdown';\nimport allowNode from './allowNode';\nimport { loadLang } from './langs';\nimport './styles/markdown.less';\nimport './styles/markdowncolor.less';\n\nexport type {\n  ReactMarkdownProps,\n  MarkdownAbstractSyntaxTree,\n  NodeType,\n  RemarkParseOptions,\n  Position,\n  Point,\n  AlignType,\n  ReferenceType,\n  LinkTargetResolver,\n  Renderers,\n} from 'react-markdown';\n\nexport interface IMarkdownPreviewProps extends Omit<ReactMarkdownProps, 'className'> {\n  prefixCls?: string;\n  className?: string;\n  style?: React.CSSProperties;\n  onScroll?: (e: React.UIEvent<HTMLDivElement>) => void;\n  onMouseOver?: (e: React.MouseEvent<HTMLDivElement>) => void;\n}\n\nexport interface IMarkdownPreviewState {\n  value?: string;\n}\n\nexport default class MarkdownPreview extends Component<IMarkdownPreviewProps, IMarkdownPreviewState> {\n  public mdp = React.createRef<HTMLDivElement>();\n  public loadedLang: string[] = ['markup'];\n  public static defaultProps: IMarkdownPreviewProps = {\n    renderers: {},\n  }\n  public constructor(props: IMarkdownPreviewProps) {\n    super(props);\n    this.state = {\n      value: '' || props.source,\n    };\n  }\n  componentDidMount() {\n    this.highlight();\n  }\n  componentDidUpdate(prevProps: IMarkdownPreviewProps) {\n    if (this.props.source !== prevProps.source) {\n      this.setState({ value: this.props.source }, () => {\n        this.highlight();\n      });\n    }\n  }\n  public renderHTML(mdStr?: string) {\n    this.setState({ value: mdStr }, () => {\n      this.highlight();\n    });\n  }\n  public async highlight() {\n    if (!this.mdp.current) return;\n    const codes = this.mdp.current.getElementsByTagName('code') as unknown as HTMLElement[];\n    for (const value of codes) {\n      const tag = value.parentNode as HTMLElement;\n      if (tag && tag.tagName === 'PRE' && /^language-/.test(value.className.trim())) {\n        const lang = value.className.trim().replace(/^language-/, '');\n        try {\n          if (!this.loadedLang.includes(lang as never)) {\n            this.loadedLang.push(lang);\n            await loadLang(lang);\n          }\n          await Prism.highlightElement(value);\n        } catch (error) { }\n      }\n    }\n  }\n  render() {\n    const { className, style, onScroll, onMouseOver, ...other } = this.props;\n    const cls = `wmde-markdown wmde-markdown-color ${className || ''}`;\n    return (\n      <div ref={this.mdp} onScroll={onScroll} style={style} onMouseOver={onMouseOver} className={cls} >\n        <ReactMarkdown escapeHtml={false} allowNode={allowNode} {...other} source={this.state.value} />\n      </div>\n    );\n  }\n}"]}